(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2bb9c9f8"],{"19bc":function(t,e,n){},"32af":function(t,e,n){},"7db0":function(t,e,n){"use strict";var i=n("23e7"),a=n("b727").find,s=n("44d2"),r="find",o=!0;r in[]&&Array(1)[r]((function(){o=!1})),i({target:"Array",proto:!0,forced:o},{find:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),s(r)},8557:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("h2",{staticStyle:{"text-align":"center"}},[t._v("Vue-barrage 基于vue的弹幕组件")]),n("div",{staticStyle:{height:"400px",width:"800px",position:"relative",margin:"0px auto",background:"#000"}},[n("v-barrage",{attrs:{arr:t.arr,isPause:t.isPause,percent:100}})],1),n("div",{staticClass:"barrage-control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.sendContent,expression:"sendContent"}],attrs:{type:"text",placeholder:"回车发送",id:"sendContent"},domProps:{value:t.sendContent},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendBarrage(e)},input:function(e){e.target.composing||(t.sendContent=e.target.value)}}}),t._v(" 方向: "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.direction,expression:"direction"}],staticStyle:{margin:"0px 12px"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.direction=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"default"}},[t._v("默认")]),n("option",{attrs:{value:"top"}},[t._v("顶部")])]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.isJs,expression:"isJs"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.isJs)?t._i(t.isJs,null)>-1:t.isJs},on:{change:function(e){var n=t.isJs,i=e.target,a=!!i.checked;if(Array.isArray(n)){var s=null,r=t._i(n,s);i.checked?r<0&&(t.isJs=n.concat([s])):r>-1&&(t.isJs=n.slice(0,r).concat(n.slice(r+1)))}else t.isJs=a}}}),t._v(" js弹幕(直接写代码) "),n("button",{staticStyle:{"margin-left":"25px"},attrs:{id:"sendBarrageBtn"},on:{click:t.sendBarrage}},[t._v("发送")]),n("button",{attrs:{id:"pauseBtn"},on:{click:function(e){t.isPause=!0}}},[t._v("暂停")]),n("button",{attrs:{id:"startBtn"},on:{click:function(e){t.isPause=!1}}},[t._v("开始")])])])},a=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{ref:"barrageWrapper",staticClass:"barrage-wrapper",style:{height:t.percent+"%"}},[n("div",{staticClass:"barrage-main"},[n("div",{ref:"barrageMainDm",staticClass:"barrage-main-dm",class:{"ani-pause":t.isPause,"ani-running":!t.isPause}})])])},r=[],o=(n("a9e3"),n("d3b7"),n("159b"),n("b64b"),n("caad"),n("2532"),n("99af"),n("7db0"),{props:{arr:{type:Array,default:function(){return[]}},isPause:{type:Boolean},percent:{type:Number,default:80}},data:function(){return{MAX_DM_COUNT:5,CHANNEL_COUNT:8,barrages:[],domPool:[],intervalDM:null,interValTime:500,hasPosition:[],hasTopPosition:[],barrageMainDm:null,barMainWidth:500,dmStyles:["color","fontSize"]}},computed:{},created:function(){},mounted:function(){this.barrageMainDm=this.$refs.barrageMainDm,this.barMainWidth=this.barrageMainDm.clientWidth,this.init(),this.playDm(),document.addEventListener("visibilitychange",this.visibilitychangeFn)},watch:{arr:function(t){this.barrages=t},isPause:function(t){t?this.pauseDm():this.playDm()},percent:function(t){this.CHANNEL_COUNT=t/10}},methods:{visibilitychangeFn:function(){document.hidden?(console.log("离开页面"),clearInterval(this.intervalDM),this.intervalDM=null):(this.playDm(),console.log("进入页面"))},init:function(){for(var t=this,e=(this.$refs.barrageMainDm,function(e){for(var n=[],i=function(i){var a=document.createElement("div");a.className="barrage-item",a.style.transform="translate3d(".concat(t.barMainWidth,"px,0,0)"),a.style.top=e*(t.barrageMainDm.clientHeight/t.CHANNEL_COUNT)+"px",console.log(a.style.top),a.addEventListener("animationend",(function(n){a.className="barrage-item",a.style.transform="translate3d(".concat(t.barMainWidth,"px,0,0)"),a.style.animation=null,t.dmStyles.forEach((function(t){a.style[t]=null})),t.domPool[i][e]&&(t.domPool[i][e].isFree=!1)})),n.push({row:e,col:i,el:a,isUse:!1,isFree:!1})},a=0;a<t.MAX_DM_COUNT;a++)i(a);t.domPool.push(n)}),n=0;n<this.CHANNEL_COUNT;n++)e(n);for(var i=0;i<this.CHANNEL_COUNT;i++)this.hasPosition[i]=!0,this.hasTopPosition[i]=!0},getChannel:function(){for(var t=0;t<this.CHANNEL_COUNT;t++)if(this.hasPosition[t]&&this.domPool[t].length)return t;return-1},getTopChannel:function(){for(var t=0;t<this.CHANNEL_COUNT;t++)if(this.hasTopPosition[t])return t;return-1},shootDanmu:function(t,e,n){var i=this;this.hasPosition[n]=!1;var a=t.el;if(!t.isUse&&this.barrageMainDm&&(t.isUse=!0,this.barrageMainDm.appendChild(t.el)),e.style){var s=Object.keys(e.style),r=this;s.forEach((function(t){var n=r.dmStyles.includes(t);n&&(a.style[t]=e.style[t])}))}t.isFree=!0,e.isJs?a.innerHTML=e.content:a.innerText=e.content,a.className=e.isSelf?"barrage-item self-dm":"barrage-item",a.style.animation="barrage-run 5s linear",setTimeout((function(){i.hasPosition[n]=!0}),10*a.clientWidth+1e3)},shootTopDanmu:function(t,e){var n=this;this.hasTopPosition[e]=!1;var i=document.createElement("div");if(i.className=t.isSelf?"barrage-item top-item self-dm":"barrage-item top-item",t.style){var a=Object.keys(t.style),s=this;a.forEach((function(e){var n=s.dmStyles.includes(e);n&&(i.style[e]=t.style[e])}))}t.isJs?i.innerHTML=t.content:i.innerText=t.content,i.addEventListener("animationend",(function(){n.barrageMainDm.removeChild(i),n.hasTopPosition[e]=!0})),this.barrageMainDm.appendChild(i),i.style.transform="translate3d(".concat(this.barMainWidth/2-i.clientWidth/2,"px,").concat(e*i.clientHeight,"px,0)"),i.style.animation="barrage-fade 3s"},getFreeChannelDom:function(t){var e;return e=this.domPool[t].find((function(t){return!t.isFree})),e},pauseDm:function(){this.intervalDM&&(clearInterval(this.intervalDM),this.intervalDM=null)},playDm:function(){var t=this;t.intervalDM=setInterval((function(){if(t.barrages.length>0){var e,n,i=t.barrages.shift();if("top"==i.direction&&-1!=(n=t.getTopChannel())&&t.shootTopDanmu(i,n),"default"==i.direction&&-1!=(e=t.getChannel())){var a=t.getFreeChannelDom(e);a&&t.shootDanmu(a,i,e)}}}),t.interValTime)}},components:{}}),l=o,c=(n("aeb3"),n("2877")),u=Object(c["a"])(l,s,r,!1,null,null,null),d=u.exports,h={name:"home",components:{VBarrage:d},data:function(){return{arr:[],isPause:!1,sendContent:null,isJs:!1,direction:"default"}},mounted:function(){this.initTestData()},methods:{initTestData:function(){for(var t=["这是一条有弹幕","今天去打LOL","可以吗？","一起嗨！！！"],e=0;e<6;e++)for(var n=0;n<1e3;n++)n%2==0?this.arr.push({direction:"top",content:t[parseInt(Math.random()*t.length)]}):this.arr.push({direction:"default",content:t[parseInt(Math.random()*t.length)]})},sendBarrage:function(){this.arr.length>1&&""!=this.sendContent&&null!=this.sendContent?this.arr.unshift({content:this.sendContent,direction:this.direction,isSelf:!0,style:{color:"red",fontSize:"25px"},isJs:this.isJs}):this.arr.push({content:this.sendContent,direction:this.direction,isSelf:!0,style:{color:"red"},isJs:this.isJs}),this.sendContent=null}}},f=h,m=(n("d474"),Object(c["a"])(f,i,a,!1,null,"b0281c18",null));e["default"]=m.exports},aeb3:function(t,e,n){"use strict";n("19bc")},d474:function(t,e,n){"use strict";n("32af")}}]);