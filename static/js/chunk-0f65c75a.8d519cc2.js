(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0f65c75a"],{10:function(t,e){},11:function(t,e){},"3d04":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("face",{attrs:{activename:t.activeName,isrest:t.isRest},on:{restActive:t.restactive,responseFun:t.responseFun}}),i("button",{attrs:{id:"facelogin"},on:{click:t.faceLogin}},[t._v("人脸登录")]),i("input",{ref:"file",attrs:{type:"file",accept:"image/*",capture:"user"}})],1)},a=[],o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"app-container"},[i("div",{staticClass:"warpper"},[i("div",{staticClass:"btnBox"},[i("div",{staticClass:"left",on:{click:t.closeFaceBox}},[i("img",{attrs:{src:"/imgs/close.svg",alt:"",srcset:""}})])]),i("p",{staticClass:"tip"},[t._v(t._s(t.tipTxt))]),i("div",{staticClass:"photoBox"},[i("video",{directives:[{name:"show",rawName:"v-show",value:!t.isOpenMouth,expression:"!isOpenMouth"}],ref:"myVideo",attrs:{id:"myVideo",preload:"auto",loop:"",playsinline:"",muted:"",autoplay:"","webkit-playsinline":"true"},domProps:{muted:!0},on:{play:function(e){return t.onPlay(e)}}}),i("canvas",{directives:[{name:"show",rawName:"v-show",value:!t.isOpenMouth,expression:"!isOpenMouth"}],ref:"overlay",attrs:{id:"overlay"}}),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.isOpenMouth,expression:"!isOpenMouth"}],class:t.hovertxt?"active":"",attrs:{id:"hoverTxt"}},[t._v(t._s(t.hovertxt))])]),i("div",{staticStyle:{display:"block"}},[i("img",{staticClass:"imgSrc",attrs:{src:t.imgSrc,alt:""}})]),t._m(0)])])])},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"safeBox"},[i("img",{attrs:{src:"/imgs/safe.png",alt:"",srcset:""}}),i("span",[t._v("信息已加密,仅用于身份认证")])])}],r=i("c7eb"),h=i("1da1"),c=(i("d3b7"),i("3ca3"),i("ddb0"),i("14d9"),i("ab39")),l={props:["activename","isrest"],computed:{isreset:function(){return this.isrest}},watch:{isreset:function(){this.isreset&&this.resetFun()}},data:function(){return{hovertxt:"",voiceFlag:!0,tipTxt:"模型初始化中...",vid:"",vid_width:200,vid_height:200,overlay:"",palyFlag:!1,isOpenMouth:!1,isTwinkle:!1,last_mouth_distance:0,imgSrc:"",mouthNum:0,last_nose_distance_y:0,last_nose_distance_x:0,lastTime:0,last_DIF:0,first_outline_l:[],first_outline_r:[],counter:0,last_nose_left:0,last_nose_top:0,last_dis_eye_norse:0,firstfaceImg:"",getPhotoNum:0}},mounted:function(){this.vid=this.$refs.myVideo,this.vid_width=this.$refs.myVideo.width,this.vid_height=this.$refs.myVideo.height,this.overlay=this.$refs.overlay,this.overlayCC=this.$refs.overlay.getContext("2d"),this.initFun(),console.log(this.activename+"-------------"+this.isrest)},created:function(){},methods:{faceLogin:function(){this.activeName="active",this.resetFun()},changeVoice:function(){this.voiceFlag=!this.voiceFlag},closeFaceBox:function(){this.$refs.myVideo.srcObject.getTracks()[0].stop()},initFun:function(){var t=Object(h["a"])(Object(r["a"])().mark((function t(e){var i,s=this;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=this.vid,this.overlay,Promise.all([c["e"].tinyFaceDetector.loadFromUri("/models"),c["e"].faceLandmark68Net.loadFromUri("/models"),c["e"].faceExpressionNet.loadFromUri("/models")]).then((function(){s.tipTxt="模型加载成功，正在检测人脸",navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({video:{}},(function(t){i.srcObject=t,s.palyFlag=!0}),(function(t){s.palyFlag=!1,console.error(t)}))}),(function(){s.tipTxt="模型加载错误，即将重试",s.initFun()}));case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),onPlay:function(){var t=Object(h["a"])(Object(r["a"])().mark((function t(e){var i,s,a,o,n,h,l,u,d,_=this;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this,i=this.vid,s=this.overlay,a=document.querySelector("#myVideo").videoWidth||200,o=document.querySelector("#myVideo").videoHeight||200,!this.vid.paused&&!this.vid.ended&&this.palyFlag){t.next=7;break}return t.abrupt("return",setTimeout((function(){return _.onPlay()})));case 7:return n={width:a,height:o},c["d"](s,n),t.next=11,c["b"](i,new c["a"]({inputSize:128})).withFaceLandmarks().withFaceExpressions();case 11:h=t.sent,l=c["f"](h,n),0==l.length?this.hovertxt="未检测到人脸":l[0].alignedRect.relativeBox.top>.55||l[0].alignedRect.relativeBox.left<.2||l[0].alignedRect.relativeBox.right>.8||l[0].alignedRect.relativeBox.bottom>.98?this.hovertxt="请将脸对正中间":(0==this.getPhotoNum&&this.getPhoto(),this.hovertxt="请张张嘴巴",u=l[0].landmarks,d=u.positions,this.isOpenMouth||this.openMouth(d),c["c"].drawFaceLandmarks(s,l)),this.isOpenMouth?this.getPhoto():setTimeout((function(){return _.onPlay()}));case 15:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),openMouth:function(t){var e=t[67].y-t[63].y,i=t[31].y,s=t[31].x;Math.abs(i-this.last_nose_distance_y)>3&&Math.abs(this.last_nose_distance_x-s)>4?this.hovertxt="请保持头部不要晃动":this.hovertxt="请张张嘴巴",this.last_nose_distance_y=i,this.last_nose_distance_x=s,this.last_mouth_distance>0&&e>0&&Math.abs(this.last_mouth_distance-e)>6&&Math.abs(this.last_nose_distance_y-i)<.6&&Math.abs(this.last_nose_distance_x-s)<.6&&(this.mouthNum++,this.mouthNum>2&&(console.log("张嘴通过"),this.tipTxt="验证中，请稍等...",this.isOpenMouth=!0,this.last_mouth_distance=0,this.mouthNum=0)),this.last_mouth_distance=e},getPhoto:function(){this.getPhotoNum++,this.overlayCC.clearRect(0,0,this.overlay.width,this.overlay.height),this.overlayCC.drawImage(this.vid,0,0,this.overlay.width,this.overlay.height);var t=this.overlay.toDataURL("image/png"),e="data:image/png;"+t;1==this.getPhotoNum?this.firstfaceImg=e:(this.imgSrc=e,this.$emit("responseFun",e))},shakeHead:function(t){if(0!=t.length&&(0==this.lastTime||(new Date).getTime()-this.lastTime>500&&(new Date).getTime()-this.lastTime<1e4)){var e=t[31].x-t[2].x,i=t[31].y-t[2].y,s=Math.pow(e*e+i*i,.5),a=t[16].x-t[31].x,o=t[16].y-t[31].y,n=Math.pow(a*a+o*o,.5),r=t[16].x-t[2].x,h=t[16].y-t[2].y;Math.pow(r*r+h*h,.5);this.first_outline_l.push(s),this.first_outline_r.push(n),(s>n&&Math.abs(s-this.first_outline_l[0])>20&&Math.abs(n-this.first_outline_r[0])>30||s<n&&Math.abs(s-this.first_outline_l[0])>30&&Math.abs(n-this.first_outline_r[0])>50)&&this.counter++,this.counter>1&&(console.log("摇头已验证通过"),this.getPhoto(),this.counter=0,this.first_outline_l=[],this.first_outline_r=[]),this.lastTime=(new Date).getTime()}},twinkle:function(t){if(0!=t.length&&(0==this.lastTime||(new Date).getTime()-this.lastTime>10)){var e=t[31].x-t[38].x,i=t[31].y-t[38].y,s=Math.pow(e*e+i*i,.5),a=t[31].x-t[45].x,o=t[31].y-t[45].y,n=Math.pow(a*a+o*o,.5),r=s+n;Math.abs(t[31].x-this.last_nose_left)<.5&&Math.abs(t[31].y-this.last_nose_top)<.5&&i>1e3&&(alert("眼睛验证通过"),this.getPhoto(),this.last_nose_left=0,this.last_nose_top=0,this.last_dis_eye_norse=0,this.lastTime=0,this.isTwinkle=!0),this.last_nose_left=t[31].x,this.last_nose_top=t[31].y,this.last_dis_eye_norse=r,this.lastTime=(new Date).getTime()}},resetFun:function(){this.last_nose_distance_y=0,this.last_nose_distance_x=0,this.last_mouth_distance=0,this.last_nose_left=0,this.last_nose_top=0,this.last_dis_eye_norse=0,this.lastTime=0,this.isTwinkle=!1,this.isOpenMouth=!1,this.first_outline_l=[],this.first_outline_r=[],this.mouthNum=0,this.firstfaceImg="",this.imgSrc="",document.querySelector("#imgSrc")&&document.querySelector("#imgSrc").setAttribute("src",""),this.getPhotoNum=0,this.onPlay()}}},u=l,d=(i("c6c3"),i("2877")),_=Object(d["a"])(u,o,n,!1,null,"6743916c",null),m=_.exports,v={components:{face:m},data:function(){return{msg:"",activeName:"",isRest:!1}},mounted:function(){},methods:{faceLogin:function(){this.activeName="active"},restactive:function(t){this.activeName=t,this.isRest=!1},responseFun:function(t){var e=this;console.log(t),setTimeout((function(){e.isRest=!0}),1e3)}}},f=v,p=Object(d["a"])(f,s,a,!1,null,"06657782",null);e["default"]=p.exports},"643c":function(t,e,i){},9:function(t,e){},c6c3:function(t,e,i){"use strict";i("643c")}}]);